
{% extends 'base.html' %}

{% load static %}

{% block title %}Mis CVs personalizados{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="{% static 'css/styles.css' %}">

{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-10">

            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="mb-0">📋 Mis CVs personalizados</h1> 
                <div>
                    <a href="{% url 'cv_create' %}" class="btn btn-success shadow-sm me-2">
                        <i class="bi bi-plus-circle-fill"></i> Nuevo CV
                    </a>
                    <a href="{% url 'cv_panel' %}" class="btn btn-secondary">Cancelar</a>
                </div>
            </div>
<hr>
            {% for cv in cvs %}
            <div class="card mb-4 {{ cv.skin }}-card">
                <div class="card-body">
                    <h5 class="card-title {{ cv.skin }}-title">{{ cv.title }}</h5>
                    <h6 class="card-subtitle mb-2">📅 Creado el {{ cv.created_at|date:"d/m/Y" }}</h6>
                    <h6 class="card-subtitle mb-2 text-muted">📝 Última modificación: {{ cv.updated_at|date:"d/m/Y H:i" }}</h6>
                    

                    <p class="card-text">
                        {{ cv.selected_experiences.count }} experiencias ·
                        {{ cv.selected_educations.count }} educaciones ·
                        {{ cv.selected_languages.count }} idiomas ·
                        {{ cv.selected_softskills.count }} soft skills ·
                        {{ cv.selected_hobbies.count }} hobbies
                    </p>

                    <div class="btn-group">
                        <a href="{% url 'cv_public_view' slug=cv.slug %}" target="_blank" class="btn btn-outline-primary btn-sm">
                            🌐 Ver
                        </a>
                        <a href="{% url 'cv_edit' pk=cv.pk %}" class="btn btn-outline-secondary btn-sm">
                            ✏️ Editar
                        </a>
                        <a href="{% url 'cv_clone' pk=cv.pk %}" class="btn btn-outline-warning btn-sm">
                            📋 Clonar
                        </a>
                        <a href="{% url 'cv_delete' pk=cv.pk %}" class="btn btn-outline-danger btn-sm">
                            🗑️ Eliminar
                        </a>
                        <a href="{% url 'probar_url' %}" class="btn btn-sm btn-outline-primary me-1">URL</a>
                    </div>
                </div>
            </div>
            {% empty %}
                <div class="alert alert-info">No has creado ningún CV aún.</div>
                {% endfor %}

                <!-- 🚀 FORMULARIO PARA DESCARGAR EN ZIP -->
                <div class="card mt-5 bg-light border-radius p-2 shadow-lg">
                    <div class="card-body">
                        <h2 class="card-title mb-4">📥 Descargar CVs seleccionados</h2>
                        <form method="post" action="{% url 'download_selected_cvs' %}">
                            {% csrf_token %}
                            <ul class="list-group mb-3">
                                {% for cv in cvs %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <label class="mb-0">
                                        <input type="checkbox" name="selected_cvs" value="{{ cv.id }}">
                                        {{ cv.title }} ({{ cv.user.username }})
                                    </label>
                                </li>
                                {% endfor %}
                            </ul>
                            <button type="submit" class="btn btn-primary">📦 Descargar seleccionados en ZIP</button>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>

</body>

</html>
{% endblock %}